import { Meta } from "@storybook/blocks";

<Meta title="Monitoramento/Or√ßamentos de Performance" />

# Or√ßamentos de Performance

## Vis√£o Geral

O sistema de or√ßamentos de performance permite definir limites aceit√°veis para m√©tricas cr√≠ticas, monitorar compliance em tempo real e receber alertas autom√°ticos quando os limites s√£o excedidos. Baseado nos Core Web Vitals e m√©tricas customizadas.

## Conceitos Fundamentais

### O que s√£o Or√ßamentos de Performance?

Or√ßamentos de performance s√£o limites definidos para m√©tricas que garantem uma experi√™ncia de usu√°rio aceit√°vel. Quando uma m√©trica excede seu or√ßamento, √© sinal de que a performance precisa ser otimizada.

### Benef√≠cios

- **Preven√ß√£o Proativa**: Identifica problemas antes que afetem usu√°rios
- **Objetivos Quantific√°veis**: Metas claras e mensur√°veis
- **Alertas Autom√°ticos**: Notifica√ß√µes quando limites s√£o ultrapassados
- **Otimiza√ß√£o Guiada**: Foco em melhorias que mais impactam UX

## Or√ßamentos Padr√£o

### Core Web Vitals

| M√©trica | Or√ßamento | Severidade | Justificativa |
|---------|-----------|------------|---------------|
| **LCP** | ‚â§ 2500ms | Error | Conte√∫do principal deve carregar rapidamente |
| **INP** | ‚â§ 100ms | Error | Intera√ß√µes devem ser responsivas |
| **CLS** | ‚â§ 0.1 | Error | Layout deve permanecer est√°vel |

### M√©tricas Adicionais

| M√©trica | Or√ßamento | Severidade | Justificativa |
|---------|-----------|------------|---------------|
| **FCP** | ‚â§ 1800ms | Warning | Primeiro conte√∫do deve aparecer r√°pido |
| **TTFB** | ‚â§ 600ms | Warning | Servidor deve responder rapidamente |
| **Bundle Size** | ‚â§ 500KB | Warning | Aplica√ß√£o deve carregar eficientemente |

## Configura√ß√£o

### Interface de Configura√ß√£o

Acesse via Performance Dashboard ‚Üí "üí∞ Or√ßamentos"

#### Campos de Configura√ß√£o

```typescript
interface PerformanceBudget {
  id: string;              // Identificador √∫nico
  name: string;            // Nome descritivo
  metric: string;          // M√©trica monitorada
  budget: number;          // Valor limite
  unit: 'ms' | 'score' | 'bytes';  // Unidade de medida
  severity: 'warning' | 'error';   // N√≠vel de severidade
  enabled: boolean;        // Or√ßamento ativo
  description?: string;    // Descri√ß√£o opcional
}
```

### Exemplo Pr√°tico

```javascript
// Or√ßamento para LCP
{
  id: 'lcp-budget',
  name: 'Largest Contentful Paint',
  metric: 'LCP',
  budget: 2500,
  unit: 'ms',
  severity: 'error',
  enabled: true,
  description: 'Conte√∫do principal deve carregar em at√© 2.5s'
}
```

## Avalia√ß√£o de Compliance

### Status dos Or√ßamentos

- **‚úÖ Pass**: M√©trica dentro do or√ßamento
- **‚ö†Ô∏è Warning**: M√©trica acima do or√ßamento (toler√¢ncia)
- **‚ùå Fail**: M√©trica cr√≠tica acima do or√ßamento

### C√°lculo de Score

```javascript
const score = Math.round((passedBudgets / totalBudgets) * 100);
// Exemplo: 4/5 budgets passaram = 80% score
```

### Relat√≥rio de Compliance

```typescript
interface BudgetResult {
  budget: PerformanceBudget;
  current: number;        // Valor atual da m√©trica
  status: 'pass' | 'warning' | 'fail';
  difference: number;     // Diferen√ßa do or√ßamento
  percentage: number;     // Percentual acima/abaixo
}
```

## Integra√ß√£o com Alertas

### Alertas Autom√°ticos

Quando um or√ßamento √© excedido, o sistema pode:

1. **Log no Console**: Avisos de desenvolvimento
2. **Notifica√ß√µes por Email/Slack**: Alertas para equipe
3. **Integra√ß√£o com CI/CD**: Quebras em pipelines

### Regras de Alerta

```javascript
// Alerta para or√ßamento cr√≠tico
if (budgetResult.status === 'fail') {
  alertService.checkMetrics([{
    name: budget.metric,
    value: budgetResult.current,
    rating: 'poor',
    timestamp: Date.now()
  }]);
}
```

## Boas Pr√°ticas

### Defini√ß√£o de Or√ßamentos

#### Princ√≠pios

1. **Baseado em Dados**: Use dados reais de usu√°rios
2. **Gradual**: Comece conservador e ajuste
3. **Realista**: Considere infraestrutura e contexto
4. **Mensur√°vel**: Metas claras e verific√°veis

#### Estrat√©gia de Defini√ß√£o

```javascript
// Abordagem conservadora (75 percentil)
const lcpBudget = Math.round(userLCPData.p75 * 0.8);

// Abordagem competitiva (90 percentil da ind√∫stria)
const industryLCP90 = 2500; // ms
const competitiveBudget = industryLCP90 * 0.9;
```

### Monitoramento Cont√≠nuo

#### M√©tricas de Meta

- **Taxa de Compliance**: % de sess√µes dentro do or√ßamento
- **Tend√™ncias**: Melhoria/degrada√ß√£o ao longo do tempo
- **Impacto**: Correla√ß√£o com m√©tricas de neg√≥cio

#### Revis√£o Regular

```javascript
// Revisar budgets mensalmente
const monthlyReview = {
  complianceRate: calculateComplianceRate(),
  recommendations: generateBudgetAdjustments(),
  alertsTriggered: countBudgetAlerts()
};
```

## Implementa√ß√£o T√©cnica

### Servi√ßo de Budgets

```typescript
import { budgetService } from '../services/budgetService';

// Verificar compliance
const results = budgetService.evaluateBudgets(metrics);

// Obter resumo
const summary = budgetService.getBudgetSummary(results);

// Exportar/importar configura√ß√£o
const config = budgetService.exportBudgets();
budgetService.importBudgets(config);
```

### Hook de Performance

```typescript
// Em usePerformanceMonitoring.ts
useWebVitals((metric) => {
  // Verificar budgets
  const budgetResults = budgetService.checkBudgetAlerts([metric]);

  if (budgetResults.some(r => r.status === 'fail')) {
    console.error('üí∞ Or√ßamento excedido:', metric.name);
  }
});
```

## Integra√ß√£o com CI/CD

### Lighthouse CI

```yaml
# .github/workflows/performance.yml
- name: Performance Budget
  uses: treosh/lighthouse-ci-action@v10
  with:
    urls: https://adsmagic.com
    budgetPath: .lighthouserc.json
    uploadArtifacts: true
```

### Lighthouse Config

```json
// .lighthouserc.json
{
  "ci": {
    "collect": {
      "numberOfRuns": 3,
      "startServerCommand": "npm run serve"
    },
    "assert": {
      "assertions": {
        "categories:performance": ["error", {"minScore": 0.9}],
        "categories:accessibility": ["error", {"minScore": 0.9}],
        "categories:best-practices": ["error", {"minScore": 0.9}],
        "categories:seo": ["error", {"minScore": 0.9}]
      }
    }
  }
}
```

### Bundle Analyzer

```javascript
// webpack.config.js
const BundleAnalyzerPlugin = require('webpack-bundle-analyzer').BundleAnalyzerPlugin;

module.exports = {
  plugins: [
    new BundleAnalyzerPlugin({
      analyzerMode: 'static',
      reportFilename: 'bundle-report.html',
      openAnalyzer: false,
    })
  ]
};
```

## Casos de Uso

### E-commerce

```javascript
// Or√ßamentos cr√≠ticos para convers√£o
const ecommerceBudgets = [
  { metric: 'LCP', budget: 2000, severity: 'error' },    // Produto vis√≠vel r√°pido
  { metric: 'INP', budget: 80, severity: 'error' },      // Carrinho responsivo
  { metric: 'CLS', budget: 0.05, severity: 'error' }     // Layout est√°vel
];
```

### Aplica√ß√£o Corporativa

```javascript
// Or√ßamentos para produtividade
const enterpriseBudgets = [
  { metric: 'FCP', budget: 1500, severity: 'warning' },  // Dashboard carrega r√°pido
  { metric: 'TTFB', budget: 400, severity: 'warning' },  // API responsiva
  { metric: 'bundle_size', budget: 300, severity: 'warning' } // App leve
];
```

### Mobile-First

```javascript
// Or√ßamentos otimizados para mobile
const mobileBudgets = [
  { metric: 'LCP', budget: 3000, severity: 'error' },    // Mobile mais lento
  { metric: 'INP', budget: 150, severity: 'error' },     // Toque responsivo
  { metric: 'bundle_size', budget: 200, severity: 'error' } // Redes m√≥veis
];
```

## Troubleshooting

### Problemas Comuns

#### Or√ßamentos Muito Estritos

**Sintomas**: Muitos alertas falsos positivos

**Solu√ß√µes**:
- Aumentar budgets gradualmente
- Usar percentis mais altos (p90 vs p75)
- Considerar contexto (mobile vs desktop)

#### Or√ßamentos Muito Flex√≠veis

**Sintomas**: Problemas n√£o detectados

**Solu√ß√µes**:
- Reduzir budgets baseado em dados
- Usar benchmarks da ind√∫stria
- Implementar melhorias incrementais

#### Dados Inconsistentes

**Sintomas**: M√©tricas variam muito

**Solu√ß√µes**:
- Aumentar sample size
- Filtrar condi√ß√µes especiais (3G lento)
- Usar medianas ao inv√©s de m√©dias

## Pr√≥ximos Passos

### Melhorias Planejadas

1. **Machine Learning**: Ajuste autom√°tico de budgets
2. **Predi√ß√£o**: Alertas preventivos baseados em tend√™ncias
3. **Segmenta√ß√£o**: Budgets diferentes por audience
4. **Integra√ß√£o**: Webpack, Vite, Rollup plugins
5. **Dashboards**: Visualiza√ß√£o avan√ßada de compliance